---
import { languages, ui, defaultLang } from "../I18N/ui";
import { useTranslations } from "../I18N/utils";

interface Props {
  lang: keyof typeof ui;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const navItems = [
  { name: t("nav.about"), href: "#about-me" },
  { name: t("nav.skills"), href: "#skills" },
  { name: t("nav.experience"), href: "#experiencia" },
  { name: t("nav.projects"), href: "#proyectos" },
  { name: t("nav.contact"), href: "#contacto" },
];
---

<header
  class="sticky top-0 z-50 w-full border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-950/80 backdrop-blur-xs"
>
  <div class="wrapper flex h-16 items-center justify-between">
    <a
      href={`/${lang}`}
      class="text-xl font-bold tracking-tight hover:text-blue-600 dark:hover:text-blue-400 transition"
    >
      Alexis<span class="text-blue-600 dark:text-blue-400"> GarcÃ­a</span>.
    </a>

    <nav class="hidden md:flex gap-6">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class="text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition"
          >
            {item.name}
          </a>
        ))
      }
    </nav>

    <div class="flex items-center gap-4">
      <div class="relative">
        <button
          id="lang-toggle-btn"
          class="flex items-center gap-1 text-sm font-medium text-slate-600 dark:text-slate-300 hover:opacity-80 transition-colors"
          aria-haspopup="true"
          aria-expanded="false"
        >
          {lang.toUpperCase()} â–¼
        </button>

        <div
          id="lang-dropdown"
          class="hidden absolute right-0 top-full pt-2 z-50"
        >
          <ul
            class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg shadow-lg py-1 w-24 overflow-hidden"
          >
            {
              Object.entries(languages).map(([key, label]) => (
                <li>
                  <a
                    href={`/${key}/`}
                    class={`block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-800 ${key === lang ? "font-bold text-blue-600 dark:text-blue-400" : "text-slate-600 dark:text-slate-300"}`}
                  >
                    {label}
                  </a>
                </li>
              ))
            }
          </ul>
        </div>
      </div>

      <button
        id="theme-toggle"
        class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition cursor-pointer"
        aria-label="Cambiar tema"
      >
        <span class="hidden dark:inline">ðŸŒž</span>
        <span class="inline dark:hidden">ðŸŒ™</span>
      </button>

      <button
        id="menu-btn"
        class="md:hidden p-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
        aria-label="Abrir menÃº"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-6 h-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
        </svg>
      </button>
    </div>
  </div>

  <div
    id="mobile-menu"
    class="hidden md:hidden border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 absolute w-full left-0 top-16 shadow-lg"
  >
    <div class="flex flex-col p-4 space-y-4">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class="block text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition"
          >
            {item.name}
          </a>
        ))
      }
    </div>
  </div>
</header>

<script>
  const themeToggleButton = document.getElementById("theme-toggle");
  themeToggleButton?.addEventListener("click", () => {
    document.documentElement.classList.toggle("dark");
    if (document.documentElement.classList.contains("dark")) {
      localStorage.setItem("theme", "dark");
    } else {
      localStorage.setItem("theme", "light");
    }
  });

  const menuButton = document.getElementById("menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const languageButton = document.getElementById("lang-toggle-btn");
  const languageDropdown = document.getElementById("lang-dropdown");

  menuButton?.addEventListener("click", (e) => {
    e.stopPropagation();
    mobileMenu?.classList.toggle("hidden");

    languageDropdown?.classList.add("hidden");
    languageButton?.setAttribute("aria-expanded", "false");
  });

  languageButton?.addEventListener("click", (e) => {
    e.stopPropagation();
    languageDropdown?.classList.toggle("hidden");

    mobileMenu?.classList.add("hidden");

    const isExpanded = !languageDropdown?.classList.contains("hidden");
    languageButton.setAttribute("aria-expanded", isExpanded.toString());
  });

  const mobileLinks = mobileMenu?.querySelectorAll("a");
  mobileLinks?.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu?.classList.add("hidden");
    });
  });

  document.addEventListener("click", (e) => {
    const target = e.target as HTMLElement;

    if (
      mobileMenu &&
      !mobileMenu.classList.contains("hidden") &&
      !mobileMenu.contains(target) &&
      !menuButton?.contains(target)
    ) {
      mobileMenu.classList.add("hidden");
    }

    if (
      languageDropdown &&
      !languageDropdown.classList.contains("hidden") &&
      !languageDropdown.contains(target) &&
      !languageButton?.contains(target)
    ) {
      languageDropdown.classList.add("hidden");
      languageButton?.setAttribute("aria-expanded", "false");
    }
  });
</script>
